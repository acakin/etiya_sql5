--1. Product isimlerini (`ProductName`) ve birim başına miktar (`QuantityPerUnit`) değerlerini almak için sorgu yazın.
SELECT productname, quantityperunit from Products;

--2. Ürün Numaralarını (`ProductID`) ve Product isimlerini (`ProductName`) değerlerini almak için sorgu yazın. Artık satılmayan ürünleri (`Discontinued`) filtreleyiniz.
SELECT productid, productname from Products
WHERE discontinued = 1;

--3. Durdurulan Ürün Listesini, Ürün kimliği ve ismi (`ProductID`, `ProductName`) değerleriyle almak için bir sorgu yazın.
SELECT discontinued, productid, productname from Products
WHERE discontinued = 1;

--4. Ürünlerin maliyeti 20'dan az olan Ürün listesini (`ProductID`, `ProductName`, `UnitPrice`) almak için bir sorgu yazın.
SELECT productid, productname, unitprice from Products
where unitprice < 20;

--5. Ürünlerin maliyetinin 15 ile 25 arasında olduğu Ürün listesini (`ProductID`, `ProductName`, `UnitPrice`) almak için bir sorgu yazın.
SELECT productid, productname, unitprice from Products
WHERE unitprice BETWEEN 15 and 25;

--6. Ürün listesinin (`ProductName`, `UnitsOnOrder`, `UnitsInStock`) stoğun siparişteki miktardan az olduğunu almak için bir sorgu yazın.
SELECT productname, unitsonorder, unitsinstock from Products
WHERE unitsonorder > unitsinstock;

-- 7. İsmi `a` ile başlayan ürünleri listeleyeniz.
SELECT productname from Products
where productname LIKE 'a%';

--8. İsmi `i` ile biten ürünleri listeleyeniz.
SELECT productname from Products
where productname LIKE '%i';

--9. Ürün birim fiyatlarına %18’lik KDV ekleyerek listesini almak (ProductName, UnitPrice, UnitPriceKDV) için bir sorgu yazın.
SELECT productname, unitprice, ROUND(unitprice * 1.18, 2) AS unitpriceKDV from Products

--10. Fiyatı 30 dan büyük kaç ürün var?
SELECT COUNT(productid) FROM Products
where unitprice > 30;

--11. Ürünlerin adını tamamen küçültüp fiyat sırasına göre tersten listele
SELECT LOWER(productname), unitprice from Products
order by unitprice DESC;

--12. Çalışanların ad ve soyadlarını yanyana gelecek şekilde yazdır
SELECT firstname || ' ' || lastname as FullName FROM Employees;

--13. Region alanı NULL olan kaç tedarikçim var?
SELECT COUNT(supplierid) from Suppliers
where Region ISNULL;

--14. a.Null olmayanlar?
SELECT COUNT(supplierid) from Suppliers
where Region IS not NULL;

--15. Ürün adlarının hepsinin soluna TR koy ve büyültüp olarak ekrana yazdır.
SELECT 'TR' || UPPER(productname) from Products;

--16. a.Fiyatı 20den küçük ürünlerin adının başına TR ekle
SELECT 'TR' || UPPER(productname), unitprice from Products
where unitprice < 20;

--17. En pahalı ürün listesini (`ProductName` , `UnitPrice`) almak için bir sorgu yazın.
SELECT productname, MAX(unitprice) from Products;

--18. En pahalı on ürünün Ürün listesini (`ProductName` , `UnitPrice`) almak için bir sorgu yazın.
SELECT productname, unitprice FROM Products
order by unitprice desc
LIMIT 10;

--19. Ürünlerin ortalama fiyatının üzerindeki Ürün listesini (`ProductName` , `UnitPrice`) almak için bir sorgu yazın.
SELECT productname, unitprice from Products
where unitprice > (SELECT AVG(unitprice) from Products);

--20. Stokta olan ürünler satıldığında elde edilen miktar ne kadardır.
SELECT SUM(unitsinstock * unitprice) from Products;

--21. Mevcut ve Durdurulan ürünlerin sayılarını almak için bir sorgu yazın.
SELECT 
SUM(CASE when discontinued = 0 then 1 else 0 END) As Mevcut,
SUM(CASE when discontinued = 1 then 1 else 0 END) As Durdurulan
from Products;

--22. Ürünleri kategori isimleriyle birlikte almak için bir sorgu yazın. 
SELECT p.productname, c.categoryname from Products p 
JOIN Categories c 
on p.CategoryID = c.CategoryID;

--23. Ürünlerin kategorilerine göre fiyat ortalamasını almak için bir sorgu yazın.
SELECT c.categoryname, AVG(p.UnitPrice) from Products p 
JOIN Categories c 
on p.CategoryID = c.CategoryID
GROUP by c.CategoryID;

--24. En pahalı ürünümün adı, fiyatı ve kategorisin adı nedir?
SELECT c.categoryname, p.ProductName, MAX(p.UnitPrice) from Products p 
JOIN Categories c 
on p.CategoryID = c.CategoryID;

--25. En çok satılan ürününün adı, kategorisinin adı ve tedarikçisinin adı
SELECT p.productname, SUM(od.Quantity) 'TotalOrder',c.categoryname, s.companyname from Products p 
JOIN Categories c 
on c.CategoryID = p.CategoryID
JOIN Suppliers s 
on s.SupplierID = p.SupplierID
Join 'Order Details' od
on p.ProductID = od.ProductID
GROUP by p.ProductID
Order By 'TotalOrder' Desc
LIMIT 1;

--26. Stokta bulunmayan ürünlerin ürün listesiyle birlikte tedarikçilerin ismi ve iletişim numarasını (`ProductID`, `ProductName`, `CompanyName`, `Phone`) almak için bir sorgu yazın.
SELECT p.productid, p.productname, s.companyname, s.phone FROM Products p 
join Suppliers s
on s.SupplierID = p.SupplierID
WHERE p.UnitsInStock = 0

--27. 2013 yılı mart ayındaki siparişlerimin adresi, siparişi alan çalışanın adı, çalışanın soyadı
SELECT o.orderdate, o.ShipAddress, e.firstname, e.LastName from Orders o 
JOIN Employees e 
on e.EmployeeID = o.EmployeeID
where  o.OrderDate >= '2013-03-01' AND o.OrderDate < '2013-04-01';

-- 28. 2013 yılı şubat ayında kaç siparişim var?
SELECT COUNT(o.orderdate) from Orders o 
where  o.OrderDate >= '2013-02-01' AND o.OrderDate < '2013-03-01';

--29. London şehrinden 2013 yılında kaç siparişim var?
SELECT COUNT(o.orderdate) from Orders o 
where  o.OrderDate >= '2013-01-01' AND o.OrderDate < '2014-01-01' and o.ShipCity = 'London';

--30. 2013 yılında sipariş veren müşterilerimin contactname ve telefon numarası
SELECT c.ContactName, c.Phone from Orders o 
JOIN Customers c 
on c.CustomerID = o.CustomerID
where  o.OrderDate >= '2013-01-01' AND o.OrderDate < '2014-01-01';

--31. Taşıma ücreti 40 üzeri olan siparişlerim
SELECT * from Orders 
WHERE freight > 40;

--32. Taşıma ücreti 40 ve üzeri olan siparişlerimin şehri, müşterisinin adı
SELECT o.shipcity, c.CompanyName, o.Freight from Orders o
JOIN Customers c 
on o.CustomerID = c.CustomerID
WHERE freight > 40;

--33. 2013 yılında verilen siparişlerin tarihi, şehri, çalışan adı -soyadı ( ad soyad birleşik olacak ve büyük harf),
SELECT o.OrderDate, o.ShipCity, UPPER(e.firstname || ' ' || e.lastname) FullName from Employees e
JOIN Orders o 
on o.EmployeeID = e.EmployeeID
where o.OrderDate >= '2013-01-01' AND o.OrderDate < '2014-01-01';

--34. 2013 yılında sipariş veren müşterilerin contactname i, ve telefon numaraları ( telefon formatı 2223322 gibi olmalı )
SELECT c.contactname, SUBSTR(REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(c.phone, '(', ''), ')', ''), '-', ''), '.', ''), ' ', ''), -7) AS Last7Digits from Customers c
join Orders o 
on o.CustomerID = c.CustomerID
where o.OrderDate >= '2013-01-01' AND o.OrderDate < '2014-01-01';

--35. Sipariş tarihi, müşteri contact name, çalışan ad, çalışan soyad
SELECT o.orderdate, c.contactname, e.firstname, e.lastname from Orders o 
JOIN Customers c 
on c.CustomerID = o.CustomerID
JOIN Employees e 
on e.EmployeeID = o.EmployeeID;

--36. Geciken siparişlerim?
SELECT orderid, requireddate, shippeddate from Orders 
where requireddate < shippeddate;

--37. Geciken siparişlerimin tarihi, müşterisinin adı
SELECT o.orderid, o.requireddate, o.shippeddate, c.CompanyName from Orders o
JOIN Customers c 
on c.CustomerID = o.CustomerID
where requireddate < shippeddate;

--38. 10248 nolu siparişte satılan ürünlerin adı, kategorisinin adı, adedi
SELECT p.productname, c.categoryname, od.Quantity from Products p 
join Categories c
on c.CategoryID = p.CategoryID
JOIN 'Order Details' od 
on p.ProductID = od.ProductID
where od.OrderID = 10248;

--39. 10248 nolu siparişin ürünlerinin adı , tedarikçi adı
SELECT p.productname, s.companyname from Products p 
join Suppliers s
on s.SupplierID = p.SupplierID
JOIN 'Order Details' od 
on p.ProductID = od.ProductID
where od.OrderID = 10248;

--40. 3 numaralı ID ye sahip çalışanın 2013 yılında sattığı ürünlerin adı ve adeti
SELECT p.productname, od.quantity from Products p 
JOIN 'Order Details' od 
on p.ProductID = od.ProductID
join Orders o 
on o.OrderID = od.OrderID
where o.EmployeeID = 3 AND o.OrderDate >= '2013-01-01' AND o.OrderDate < '2014-01-01';

--41. 2013 yılında bir defasinda en çok satış yapan çalışanımın ID,Ad soyad
SELECT e.FirstName, e.LastName, SUM(od.quantity) from 'Order Details' od 
JOIN Orders o 
on o.OrderID = od.OrderID
JOIN Employees e 
on o.EmployeeID = e.EmployeeID
where OrderDate >= '2013-01-01' AND o.OrderDate < '2014-01-01'
GROUP by e.EmployeeID
ORDER by SUM(od.quantity)DESC
LIMIT 1;

--42. 1997 yılında en çok satış yapan çalışanımın ID,Ad soyad ****
SELECT e.EmployeeID, e.FirstName, e.LastName, SUM(od.quantity) AS TotalSales from 'Order Details' od 
JOIN Orders o 
on o.OrderID = od.OrderID
JOIN Employees e 
on o.EmployeeID = e.EmployeeID
where OrderDate >= '2013-01-01' AND o.OrderDate < '2014-01-01'
GROUP by e.EmployeeID
ORDER by SUM(od.quantity)DESC
LIMIT 1;

--43. En pahalı ürünümün adı,fiyatı ve kategorisin adı nedir?
SELECT p.ProductName, MAX(p.UnitPrice) MaxPrice, c.CategoryName AS TotalSales from Products p
JOIN Categories c 
on p.CategoryID = c.CategoryID;

--44. Siparişi alan personelin adı,soyadı, sipariş tarihi, sipariş ID. Sıralama sipariş tarihine göre
SELECT e.firstname, e.lastname, o.orderdate, o.orderid from Employees e 
JOIN Orders o 
on o.EmployeeID = e.EmployeeID
order by o.OrderDate;

--45. SON 5 siparişimin ortalama fiyatı ve orderid nedir?
WITH Last5Orders AS (
    SELECT o.orderid
    FROM Orders o
    ORDER BY o.orderdate DESC
    LIMIT 5
)
SELECT ROUND(AVG(od.unitprice * od.quantity), 2) AS AveragePrice, lo.orderid
FROM Last5Orders lo
JOIN "Order Details" od ON lo.orderid = od.orderid
GROUP BY lo.orderid;


--46. Ocak ayında satılan ürünlerimin adı ve kategorisinin adı ve toplam satış miktarı nedir?
SELECT p.productname, c.categoryname, SUM(od.quantity) AS TotalQuantity
FROM "Order Details" od
JOIN Orders o ON od.orderid = o.orderid
JOIN Products p ON od.productid = p.productid
JOIN Categories c ON p.categoryid = c.categoryid
WHERE o.orderdate >= '2023-01-01' AND o.orderdate < '2023-02-01'
GROUP BY p.productname, c.categoryname;

--47. Ortalama satış miktarımın üzerindeki satışlarım nelerdir?
SELECT productname, unitprice from Products  
WHERE unitprice > (SELECT AVG(unitprice) from Products);


--48. En çok satılan ürünümün(adet bazında) adı, kategorisinin adı ve tedarikçisinin adı
SELECT max(quantity), productname, categoryname, companyname from Products p 
JOIN Categories c 
on c.CategoryID = p.CategoryID
JOIN 'Order Details' od 
on p.ProductID = od.ProductID
join Suppliers s 
on p.SupplierID = s.SupplierID;

--49. Kaç ülkeden müşterim var
SELECT COUNT(DISTINCT(country)) from Customers;

--50. 3 numaralı ID ye sahip çalışan (employee) son Ocak ayından BUGÜNE toplamda ne kadarlık ürün sattı?
SELECT SUM(od.Quantity * od.UnitPrice) TotalSales from 'Order Details' od
JOIN Orders o 
on o.OrderID = od.OrderID
WHERE o.EmployeeID = 3 and o.orderdate >= '2023-01-01';


--63. Hangi ülkeden kaç müşterimiz var?
SELECT country, COUNT(customerid) CustomerCount from Customers
group by country;

--65. 10 numaralı ID ye sahip ürünümden son 3 ayda ne kadarlık ciro sağladım?
SELECT SUM(od.Quantity * od.UnitPrice) Turnover from 'Order Details' od
JOIN Orders o 
on o.OrderID = od.OrderID
where od.productid = 10 and o.OrderDate >= '2023-08-01';
